<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - TRAVEL PLANING</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f0;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background-color: #d3d3d3;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background-color: #fff;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 5px;
        }

        .logo-text {
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .logo-icon {
            font-size: 24px;
        }

        .site-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .user-info {
            color: #333;
            font-size: 14px;
        }

        .nav-menu {
            display: flex;
            gap: 20px;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .nav-menu a:hover {
            background-color: #bbb;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 40px;
            color: #333;
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .info-card {
            background-color: #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .info-card.full-width {
            grid-column: 1 / -1;
        }

        .info-card.highlight {
            border: 3px solid #4a90e2;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #bbb;
        }

        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .more-btn {
            background-color: #333;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .more-btn:hover {
            background-color: #555;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .data-table {
            width: 100%;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background-color: #666;
            color: white;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            font-weight: 600;
            font-size: 14px;
        }

        .data-table tbody tr:hover {
            background-color: #f9f9f9;
        }

        .data-table td {
            font-size: 13px;
            color: #333;
        }

        .data-table td img {
            display: block;
            margin: 0 auto;
        }

        /* ë¹ˆ ë°ì´í„° ë©”ì‹œì§€ */
        .empty-message {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }

        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background-color: #4caf50;
            color: white;
        }

        .status-inactive {
            background-color: #f44336;
            color: white;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<!-- í—¤ë” -->
<div class="header">
    <div class="logo-section">
        <div class="logo">
            <div class="logo-text">Logo</div>
            <div class="logo-icon">ğŸ–¼ï¸</div>
        </div>
        <div class="site-title">TRAVEL PLANING</div>
    </div>
    <div style="display: flex; align-items: center; gap: 30px;">
        <div class="user-info">{ê´€ë¦¬ì} ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</div>
        <div class="nav-menu">
            <a href="/">Home</a>
            <a href="/admin/view/adminpage">ê´€ë¦¬ìí˜ì´ì§€</a>
            <a href="#" onclick="logout(); return false;">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</div>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<div class="container">
    <h1 class="page-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>

    <div class="admin-grid">
        <!-- íšŒì› ì •ë³´ ì¹´ë“œ -->
        <div class="info-card">
            <div class="card-header">
                <h2 class="card-title">íšŒì› ì •ë³´</h2>
                <button class="more-btn" onclick="location.href='/admin/view/members'">ë”ë³´ê¸°</button>
            </div>
            <div class="data-table" id="memberTable">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>

        <!-- ìˆ™ì†Œ ì •ë³´ ì¹´ë“œ -->
        <div class="info-card">
            <div class="card-header">
                <h2 class="card-title">ìˆ™ì†Œ ì •ë³´</h2>
                <button class="more-btn">ë”ë³´ê¸°</button>
            </div>
            <div class="data-table">
                <div class="empty-message">ìˆ™ì†Œ ì •ë³´ APIë¥¼ êµ¬í˜„í•´ì£¼ì„¸ìš”</div>
            </div>
        </div>

        <!-- ê´€ê´‘ì§€ ì •ë³´ ì¹´ë“œ (ì „ì²´ ë„ˆë¹„) -->
        <div class="info-card full-width highlight">
            <div class="card-header">
                <h2 class="card-title">ê´€ê´‘ì§€ ì •ë³´</h2>
                <button class="more-btn" onclick="location.href='/admin/view/tourspot'">ë”ë³´ê¸°</button>
            </div>
            <div class="data-table" id="tourspotTable">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>ê´€ê´‘ì§€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    document.addEventListener('DOMContentLoaded', function() {
        loadMemberData();
        loadTourSpotData();
    });

    // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ (ì´ ë¶€ë¶„ì„ ì¶”ê°€í•´ì•¼ í•¨!)
    async function logout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            try {
                const response = await fetch('/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                const result = await response.json();

                if (response.ok) {
                    alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    window.location.href = '/login';
                } else {
                    alert('ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    }


    // íšŒì› ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadMemberData() {
        try {
            console.log('íšŒì› ë°ì´í„° ìš”ì²­ ì‹œì‘...');
            const response = await fetch('/admin/members');
            console.log('ì‘ë‹µ ìƒíƒœ:', response.status);

            const result = await response.json();
            console.log('íšŒì› API ì‘ë‹µ:', result);
            console.log('result.status:', result.status);
            console.log('result.data:', result.data);

            // ResponseDto êµ¬ì¡°: { status, message, data }
            // statusëŠ” HttpStatus ê°ì²´ì¼ ìˆ˜ ìˆìŒ
            const statusValue = result.status?.value || result.status;
            const isSuccess = statusValue === 200 || statusValue === 'OK' || result.message?.includes('ì„±ê³µ');

            console.log('ì„±ê³µ ì—¬ë¶€:', isSuccess);
            console.log('ë°ì´í„° ê°œìˆ˜:', result.data?.length);

            if (result.data && result.data.length > 0) {
                const members = result.data.slice(0, 5); // ìµœëŒ€ 5ê°œë§Œ í‘œì‹œ

                let html = `
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 50px;">ID</th>
                                    <th style="width: 100px;">ì•„ì´ë””</th>
                                    <th style="width: 100px;">ì´ë¦„</th>
                                    <th style="width: 180px;">ì´ë©”ì¼</th>
                                    <th style="width: 110px;">ì „í™”ë²ˆí˜¸</th>
                                    <th style="width: 110px;">ê¶Œí•œ</th>
                                    <th style="width: 60px;">ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                members.forEach(member => {
                    html += `
                            <tr>
                                <td>${member.id || '-'}</td>
                                <td>${member.loginId || '-'}</td>
                                <td>${member.username || '-'}</td>
                                <td>${member.email || '-'}</td>
                                <td>${member.tel || '-'}</td>
                                <td>${member.role || '-'}</td>
                                <td>${member.status || '-'}</td>
                            </tr>
                        `;
                });

                html += `
                            </tbody>
                        </table>
                    `;

                document.getElementById('memberTable').innerHTML = html;
            } else {
                document.getElementById('memberTable').innerHTML = '<div class="empty-message">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        } catch (error) {
            console.error('íšŒì› ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            document.getElementById('memberTable').innerHTML = '<div class="empty-message">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    }

    // ê´€ê´‘ì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadTourSpotData() {
        try {
            console.log('ê´€ê´‘ì§€ ë°ì´í„° ìš”ì²­ ì‹œì‘...');
            const response = await fetch('/admin/tourspot/list?page=0&size=5&sort=id');
            console.log('ì‘ë‹µ ìƒíƒœ:', response.status);

            const result = await response.json();
            console.log('ê´€ê´‘ì§€ API ì‘ë‹µ:', result);
            console.log('result.status:', result.status);
            console.log('result.data:', result.data);

            // ResponseDto êµ¬ì¡°: { status, message, data }
            const statusValue = result.status?.value || result.status;
            const isSuccess = statusValue === 200 || statusValue === 'OK' || result.message?.includes('ì„±ê³µ');

            console.log('ì„±ê³µ ì—¬ë¶€:', isSuccess);
            console.log('ë°ì´í„° êµ¬ì¡°:', result.data);

            if (result.data && result.data.content && result.data.content.length > 0) {
                const tourspots = result.data.content;

                let html = `
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 50px;">ID</th>
                                    <th style="width: 120px;">ì´ë¯¸ì§€</th>
                                    <th style="width: 200px;">ì œëª©</th>
                                    <th>ì£¼ì†Œ</th>
                                    <th style="width: 80px;">ì¶”ì²œìˆ˜</th>
                                    <th style="width: 60px;">ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                tourspots.forEach(spot => {
                    // ì´ë¯¸ì§€ URL ì²˜ë¦¬
                    const imgSrc = spot.firstImage || '/images/no-image.png';
                    const recCount = spot.recCount || 0;

                    html += `
                            <tr>
                                <td>${spot.id || '-'}</td>
                                <td><img src="${imgSrc}" alt="${spot.title}" style="width: 100px; height: 70px; object-fit: cover; border-radius: 4px;" onerror="this.src='/images/no-image.png'"></td>
                                <td>${spot.title || '-'}</td>
                                <td>${spot.address || '-'}</td>
                                <td>${recCount}</td>
                                <td>${spot.status || '-'}</td>
                            </tr>
                        `;
                });

                html += `
                            </tbody>
                        </table>
                    `;

                document.getElementById('tourspotTable').innerHTML = html;
            } else {
                document.getElementById('tourspotTable').innerHTML = '<div class="empty-message">ë“±ë¡ëœ ê´€ê´‘ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        } catch (error) {
            console.error('ê´€ê´‘ì§€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            document.getElementById('tourspotTable').innerHTML = '<div class="empty-message">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    }
</script>
</body>
</html>