<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관리자 | 관광지 목록</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <style>
        body { background-color: #fffbe9; font-family: 'Noto Sans KR', sans-serif; }
        header {
            background-color: #ddd;
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 40px; border-bottom: 2px solid #ccc;
        }
        header img { width: 80px; height: 80px; }
        header .title { font-size: 24px; font-weight: bold; }
        header .nav {
            display: flex; gap: 20px; font-size: 15px;
        }
        header .nav a { text-decoration: none; color: black; }
        main {
            width: 90%; margin: 40px auto; background-color: white;
            padding: 20px; border-radius: 10px; box-shadow: 0 0 8px #ccc;
        }
        h2 { text-align: center; margin-bottom: 20px; }
        table {
            width: 100%; border-collapse: collapse; text-align: center;
        }
        th, td {
            border: 1px solid #ccc; padding: 10px;
        }
        th { background-color: #f8f8f8; }
        .add-btn {
            float: right; background-color: #333; color: white; border: none;
            padding: 8px 12px; border-radius: 6px; margin-bottom: 10px;
        }
        .delete-btn {
            background-color: #1200ff; color: white;
            border: none; padding: 5px 10px; border-radius: 4px;
            cursor: pointer;
        }
        .pagination {
            display: flex; justify-content: center; margin-top: 20px;
            align-items: center; gap: 5px;
        }
        .pagination a {
            padding: 5px 10px; border-radius: 5px; color: black; text-decoration: none;
        }
        .pagination .active {
            background-color: black; color: white;
        }
        footer {
            text-align: center; color: gray; margin-top: 20px;
            font-size: 13px;
        }
    </style>
</head>
<body>
<header>
    <div style="display: flex; align-items: center; gap: 20px;">
        <img th:src="@{/images/logo.png}" alt="Logo">
        <div class="title">TRAVEL PLANING</div>
    </div>
    <div>
        <div style="text-align:right; font-size:14px; margin-bottom:5px;">
            (관리자) 님 환영합니다.
        </div>
        <div class="nav">
            <a th:href="@{/admin/view/members}">회원관리</a>
            <a th:href="@{/admin/view/tourspot}">관광지관리</a>
            <a th:href="@{/mypage}">마이페이지</a>
            <a th:href="@{/logout}">로그아웃</a>
        </div>
    </div>
</header>

<main>
    <!-- ✅ 관광지 추가 버튼 -->
    <button class="add-btn" th:onclick="'location.href=\'/admin/view/tourspot/add\''">관광지 추가</button>

    <h2>관광지 목록</h2>

    <table>
        <thead>
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>주소</th>
            <th>전화번호</th>
            <th>상태</th>
            <th>삭제</th>
        </tr>
        </thead>
        <tbody>
        <!-- ✅ DTO 기반으로 출력 -->
        <tr th:each="spot, iterStat : ${tourspotList}">
            <td th:text="${iterStat.count}"></td>
            <td th:text="${spot.title}">제목</td>
            <td th:text="${spot.address}">주소</td>
            <td th:text="${spot.tel}">전화번호</td>
            <td th:text="${spot.status}">상태</td>
            <td>
                <button class="delete-btn"
                        th:onclick="'deleteTourSpot(' + ${spot.id} + ')'">
                    Delete
                </button>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(tourspotList)}">
            <td colspan="6">등록된 관광지가 없습니다.</td>
        </tr>
        </tbody>
    </table>

    <div class="pagination">
        <!-- 이전 페이지 -->
        <a th:if="${currentPage > 0}"
           th:href="@{/admin/view/tourspot(page=${currentPage - 1})}">
            &lt; Previous
        </a>

        <!-- 페이지 번호 (10개씩 표시) -->
        <a th:each="i : ${#numbers.sequence(startPage, endPage - 1)}"
           th:href="@{/admin/view/tourspot(page=${i})}"
           th:text="${i + 1}"
           th:classappend="${i == currentPage} ? 'active' : ''">
        </a>


        <!-- 다음 페이지 -->
        <a th:if="${currentPage + 1 < totalPages}"
           th:href="@{/admin/view/tourspot(page=${currentPage + 1})}">
            Next &gt;
        </a>
    </div>


    <footer>
    </footer>
</main>

<script>
    // ✅ 삭제 API
    function deleteTourSpot(id) {
        if (confirm("정말 삭제하시겠습니까?")) {
            fetch(`/admin/tourspot/${id}`, {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'}
            })
                .then(res => {
                    if (res.ok) {
                        alert("삭제되었습니다.");
                        location.reload();
                    } else {
                        alert("삭제 실패");
                    }
                })
                .catch(() => alert("서버 오류"));
        }
    }
</script>
</body>
</html>
