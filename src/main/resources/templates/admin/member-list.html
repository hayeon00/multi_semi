<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ê´€ë¦¬ | Travel Planing</title>
    <link th:href="@{/css/admin.css}" rel="stylesheet">

</head>
<body>
<header>
    <div class="logo">
        <img th:src="@{/images/logo.png}" alt="Logo">
        <span class="title">TRAVEL PLANING</span>
    </div>

    <nav class="admin-nav">
        <div class="welcome-text">ê´€ë¦¬ì ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</div>
        <div class="menu-links">
            <a th:href="@{/}">Home</a>
            <a th:href="@{/mypage}">ë§ˆì´í˜ì´ì§€</a>
            <a th:href="@{/logout}">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </nav>
</header>

<main>
    <div class="admin-container">
        <aside class="admin-sidebar">
            <h2 class="admin-title">íšŒì› ê´€ë¦¬</h2>
            <p class="admin-sub">ê´€ë¦¬ì ì „ìš© í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
        </aside>

        <section class="admin-content">

            <table id="memberTable" border="1" cellpadding="10">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>ì•„ì´ë””</th>
                    <th>ì´ë¦„</th>
                    <th>ì´ë©”ì¼</th>
                    <th>ì „í™”ë²ˆí˜¸</th>
                    <th>ê¶Œí•œ</th>
                    <th>ìƒíƒœ</th>
                    <th>ì‚­ì œ</th>
                </tr>
                </thead>
                <tbody>
                <!-- JSë¡œ ì±„ì›€ -->
                </tbody>
            </table>
        </section>
    </div>
</main>

<footer>
    &copy; 2025 Travel Planing. All rights reserved.
</footer>

<script>
    async function loadMembers() {
        try {
            const response = await fetch("/admin/members", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                    //  Authorization í—¤ë” ë¶ˆí•„ìš”
                },
                credentials: "include"  //  ì¿ í‚¤ë¥¼ ìë™ìœ¼ë¡œ í•¨ê»˜ ë³´ëƒ„
            });


            if (!response.ok) {
                alert("íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ê¶Œí•œ ë˜ëŠ” í† í° í™•ì¸)");
                return;
            }

            const result = await response.json();
            const tbody = document.querySelector("#memberTable tbody");
            tbody.innerHTML = ""; // ì´ˆê¸°í™”

            result.data.forEach(member => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${member.id}</td>
                    <td>${member.loginId}</td>
                    <td>${member.username}</td>
                    <td>${member.email}</td>
                    <td>${member.tel}</td>
                    <td>${member.role}</td>
                    <td>${member.status}</td>
                    <td><button onclick="deleteMember(${member.id})">ğŸ—‘ Delete</button></td>
                `;
                tbody.appendChild(tr);
            });
        } catch (error) {
            console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
        }
    }

    async function deleteMember(id) {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        const response = await fetch(`/admin/members/${id}`, {
            method: "DELETE",
            credentials: "include"

        });

        if (response.ok) {
            alert("íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadMembers(); // ëª©ë¡ ê°±ì‹ 
        } else {
            alert("ì‚­ì œ ì‹¤íŒ¨ âŒ (ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)");
        }
    }

    function getAccessToken() {
        // JWTë¥¼ localStorageë‚˜ ì¿ í‚¤ì—ì„œ êº¼ë‚´ëŠ” ì˜ˆì‹œ (ì¿ í‚¤ ê¸°ë°˜ì´ë©´ ìˆ˜ì •)
        return localStorage.getItem("access_token");
    }

    window.onload = loadMembers;
</script>
</body>
</html>
