<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ê´€ë¦¬ | Travel Planing</title>
    <link th:href="@{/css/admin.css}" rel="stylesheet">
    <!-- âœ… ê³µí†µ JS ìœ í‹¸ (fetchWithRefresh í•¨ìˆ˜ ë“¤ì–´ìˆëŠ” íŒŒì¼) -->

</head>
<body>
<header>
    <div class="logo">
        <img th:src="@{/images/logo.png}" alt="Logo">
        <span class="title">TRAVEL PLANING</span>
    </div>

    <nav class="admin-nav">
        <div class="welcome-text">ê´€ë¦¬ì ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</div>
        <div class="menu-links">
            <a th:href="@{/}">Home</a>
            <a th:href="@{/mypage}">ë§ˆì´í˜ì´ì§€</a>
            <a th:href="@{/logout}">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </nav>
</header>

<main>
    <div class="admin-container">
        <aside class="admin-sidebar">
            <h2 class="admin-title">íšŒì› ê´€ë¦¬</h2>
            <p class="admin-sub">ê´€ë¦¬ì ì „ìš© í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
        </aside>

        <section class="admin-content">
            <table id="memberTable" border="1" cellpadding="10">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>ì•„ì´ë””</th>
                    <th>ì´ë¦„</th>
                    <th>ì´ë©”ì¼</th>
                    <th>ì „í™”ë²ˆí˜¸</th>
                    <th>ê¶Œí•œ</th>
                    <th>ìƒíƒœ</th>
                    <th>ì‚­ì œ</th>
                </tr>
                </thead>
                <tbody>
                <!-- JSë¡œ ì±„ì›€ -->
                </tbody>
            </table>
        </section>
    </div>
</main>

<footer>
    &copy; 2025 Travel Planing. All rights reserved.
</footer>

<script th:src="@{/js/common.js}"></script>


<script>
    // âœ… ê¸°ì¡´ fetch â†’ fetchWithRefresh()ë¡œ ë³€ê²½
    async function loadMembers() {
        try {
            console.log("ë‚˜íŒ¨ì¹˜í•˜ëŸ¬ ë“¤ì–´ê°„ë‹¤");
            const response = await fetchWithRefresh("/admin/members", {
                method: "GET",
                headers: { "Content-Type": "application/json" },
                credentials: "include"
            });

            if (!response.ok) {
                alert("íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ê¶Œí•œ ë˜ëŠ” í† í° í™•ì¸)");
                return;
            }

            const result = await response.json();
            const tbody = document.querySelector("#memberTable tbody");
            tbody.innerHTML = "";

            result.data.forEach(member => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${member.id}</td>
                    <td>${member.loginId}</td>
                    <td>${member.username}</td>
                    <td>${member.email}</td>
                    <td>${member.tel}</td>
                    <td>${member.role}</td>
                    <td>${member.status}</td>
                    <td><button onclick="deleteMember(${member.id})">ğŸ—‘ Delete</button></td>
                `;
                tbody.appendChild(tr);
            });
        } catch (error) {
            console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
        }
    }

    async function deleteMember(id) {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        const response = await fetchWithRefresh(`/admin/members/${id}`, {
            method: "DELETE",
            credentials: "include"
        });

        if (response.ok) {
            alert("íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadMembers();
        } else {
            alert("ì‚­ì œ ì‹¤íŒ¨ âŒ (ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)");
        }
    }

    window.onload = loadMembers;
</script>
</body>
</html>
