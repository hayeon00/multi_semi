<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      lang="ko"
      layout:decorate="~{/common/layout}">

<!-- head fragment -->
<head layout:fragment="head">
    <meta charset="UTF-8">
    <title>ê´€ê´‘ì§€ ëª©ë¡ | Travel Planning</title>

    <!-- ê³µí†µ List CSS -->
    <link rel="stylesheet" th:href="@{/css/list.css}">
    <style>
        /* ====== toolbar: ì–‘ìª½ ì •ë ¬ ====== */
        .toolbar {
            display: flex;
            justify-content: space-between; /* ì¢Œì¸¡ í† ê¸€ / ìš°ì¸¡ ê²€ìƒ‰ */
            align-items: center;
            margin-bottom: 20px;
            margin-left: 20px;
            margin-right: 20px;
            padding: 12px 25px;
            background: #f7f7f7;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
        }


        /* ====== í† ê¸€ ê·¸ë£¹ (1ì¤„ ê°•ì œ ì •ë ¬) ====== */
        .toggle-group {
            display: flex;
            align-items: center;

        }

        /* í† ê¸€ + í…ìŠ¤íŠ¸ 1ì¤„ ì •ë ¬ */
        .model-13 {
            display: flex;
            align-items: center; /* ğŸ”¥ í•µì‹¬: í† ê¸€ ë²„íŠ¼ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì •í™•íˆ 1ì¤„ë¡œ */
            gap: 8px;
            margin-left: 10px;
        }


        /* í…ìŠ¤íŠ¸ line-heightë¥¼ ê²€ìƒ‰ì°½ ë†’ì´ì™€ ë§ì¶”ê¸° */
        .toggle-text {
            font-size: 14px;
            color: #444;
            font-weight: 500;
            line-height: 40px; /* ğŸ”¥ í•µì‹¬: í† ê¸€ê³¼ ì™„ë²½íˆ ì„¸ë¡œ ì •ë ¬ */
        }


        /* ====== model-13 custom toggle (ë³µì›ë³¸) ====== */

        .model-13 .checkbox {
            position: relative;
            width: 100px;
            height: 40px;
            flex-shrink: 0;
        }

        .model-13 .checkbox input {
            display: none;
        }

        .model-13 .checkbox label {
            cursor: pointer;
            display: block;
            width: 100%;
            height: 100%;
            background: none;
            border: 3px solid #777;
            border-radius: 20px;
            position: relative;
            box-sizing: border-box;
        }

        /* OFF label */
        .model-13 .checkbox label:before {
            content: "OFF";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 13px;
            color: #666;
            transition: opacity 0.25s ease;
        }

        .model-13 .checkbox input:checked + label:before {
            opacity: 0;
        }

        /* ON pill */
        .model-13 .checkbox label:after {
            content: "ON";
            position: absolute;
            width: 28px;
            height: 28px;
            top: 50%;
            left: 6px;
            transform: translateY(-50%);
            background: #777;
            border-radius: 14px;
            color: #fff;
            font-size: 13px;
            line-height: 28px;
            text-align: center;
            text-indent: -9999px; /* OFF ìƒíƒœì—ì„œëŠ” ON ìˆ¨ê¹€ */

            transition: left 0.35s ease,
            width 0.25s ease 0.15s,
            background 0.2s,
            text-indent 0.25s ease;
        }

        .model-13 .checkbox input:checked + label {
            border-color: #329043;
        }

        /* ì²´í¬ ì‹œ pill ì´ë™ */
        .model-13 .checkbox input:checked + label:after {
            left: calc(100% - 86px);
            width: 80px;
            background: #3fb454;
            text-indent: 0;
            transition: left 0.35s ease,
            width 0.25s ease,
            text-indent 0.25s ease;
        }


        /* ====== ê²€ìƒ‰ ê·¸ë£¹ ====== */
        .search-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-group input {
            height: 40px;
            padding: 0 12px;
            font-size: 15px;
        }

        .search-group button {
            height: 40px;
            padding: 0 16px;
            font-size: 15px;
        }


    </style>
</head>

<body>

<div layout:fragment="content">

    <!-- í˜ì´ì§€ ì œëª© -->
    <h1 class="page-title">ê´€ê´‘ì§€ ëª©ë¡</h1>

    <!-- ê²€ìƒ‰/ì •ë ¬ UI -->
    <div class="toolbar">

        <!-- í† ê¸€ ê·¸ë£¹ -->
        <div class="toggle-group">
            <div class="model-13">
                <div class="checkbox">
                    <input type="checkbox" id="likeSort">
                    <label for="likeSort"></label>
                </div>
                <span class="toggle-text">ì¶”ì²œìˆœ ì •ë ¬</span>
            </div>
        </div>

        <!-- ê²€ìƒ‰ ê·¸ë£¹ -->
        <div class="search-group">
            <input type="text" id="keyword" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰">
            <button id="searchBtn">ê²€ìƒ‰</button>
        </div>

    </div>

    <!-- 3Ã—3 ê·¸ë¦¬ë“œ ì˜ì—­ -->
    <div id="spot-container" class="grid"></div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div id="pagination" class="pagination"></div>

</div>


<!-- JS fragment -->
<th:block layout:fragment="script">
    <script>
        console.log("tourspotlist.js ì‹¤í–‰ë¨");

        let page = 0;
        let sort = "id";
        let size = 9;
        let keyword = "";

        /* ===== ê´€ê´‘ì§€ ëª©ë¡ ë¡œë“œ ===== */
        function loadSpots() {
            const query = new URLSearchParams({page, sort, size, keyword});

            fetch(`/spots/list?${query}`)
                .then(res => res.json())
                .then(result => {
                    if (result.status !== 200) throw new Error(result.message);
                    const data = result.data;

                    renderSpots(data.contents);
                    renderPagination(data.totalPages);
                })
                .catch(err => {
                    console.error("âŒ ê´€ê´‘ì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                    document.getElementById("spot-container").innerHTML =
                        "<p class='empty-text'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
                });
        }

        /* ===== ê´€ê´‘ì§€ ì¹´ë“œ ë Œë”ë§ ===== */
        function renderSpots(data) {
            const container = document.getElementById("spot-container");
            container.innerHTML = "";

            if (!data || data.length === 0) {
                container.innerHTML = "<p class='empty-text'>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }

            data.forEach(spot => {
                const card = document.createElement("div");
                card.classList.add("card");

                card.innerHTML = `
                    <img src="${spot.firstImage || '/images/no-image.png'}" class="card-img" />
                    <h3>${spot.title}</h3>
                    <p>${spot.address}</p>
                    <p>ì¶”ì²œìˆ˜: ${spot.recCount}</p>
                `;

                card.addEventListener("click", () => {
                    // window.location.href = `/spots/view/tourspotdetail?id=${spot.id}`;
                    safeRedirect(`/spots/view/tourspotdetail?id=${spot.id}`);
                });

                container.appendChild(card);
            });
        }

        /* ===== í˜ì´ì§€ë„¤ì´ì…˜ ===== */
        function renderPagination(totalPages) {
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";

            if (totalPages <= 1) return;

            const prevBtn = document.createElement("button");
            prevBtn.textContent = "â† Previous";
            prevBtn.classList.add("page-btn");
            if (page === 0) prevBtn.classList.add("disabled");

            prevBtn.onclick = () => {
                if (page > 0) {
                    page--;
                    loadSpots();
                }
            };
            pagination.appendChild(prevBtn);

            const maxVisible = 5;
            let start = Math.max(0, page - 2);
            let end = Math.min(totalPages, start + maxVisible);

            if (end - start < maxVisible && start > 0) {
                start = Math.max(0, end - maxVisible);
            }

            for (let i = start; i < end; i++) {
                const pageBtn = document.createElement("button");
                pageBtn.textContent = i + 1;
                pageBtn.classList.add("page-btn");
                if (i === page) pageBtn.classList.add("active");

                pageBtn.onclick = () => {
                    page = i;
                    loadSpots();
                };

                pagination.appendChild(pageBtn);
            }

            const nextBtn = document.createElement("button");
            nextBtn.textContent = "Next â†’";
            nextBtn.classList.add("page-btn");
            if (page >= totalPages - 1) nextBtn.classList.add("disabled");

            nextBtn.onclick = () => {
                if (page < totalPages - 1) {
                    page++;
                    loadSpots();
                }
            };
            pagination.appendChild(nextBtn);
        }

        /* ===== ì •ë ¬ ì²´í¬ë°•ìŠ¤ ===== */
        document.getElementById("likeSort").addEventListener("change", e => {
            sort = e.target.checked ? "recCount" : "id";
            page = 0;
            loadSpots();
        });

        /* ===== ê²€ìƒ‰ ===== */
        document.getElementById("searchBtn").addEventListener("click", () => {
            keyword = document.getElementById("keyword").value.trim();
            page = 0;
            loadSpots();
        });

        document.getElementById("keyword").addEventListener("keypress", e => {
            if (e.key === "Enter") {
                keyword = e.target.value.trim();
                page = 0;
                loadSpots();
            }
        });

        /* ===== ìµœì´ˆ ë¡œë“œ ===== */
        loadSpots();
    </script>
</th:block>

</body>
</html>
