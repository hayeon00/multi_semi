<!--<!DOCTYPE html>-->
<!--<html lang="ko">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>내가 쓴 리뷰</title>-->
<!--    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pretendard&display=swap">-->
<!--    <style>-->
<!--        body {-->
<!--            font-family: 'Pretendard', sans-serif;-->
<!--            background: #f5f6f8;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--        }-->

<!--        .page-header {-->
<!--            display: flex;-->
<!--            justify-content: space-between;-->
<!--            align-items: center;-->
<!--            background: #f5f6f8;-->
<!--            padding: 15px 40px;-->
<!--            border-bottom: 1px solid #ccc;-->
<!--        }-->

<!--        .page-header h1 { font-size: 20px; margin: 0; color: #333; }-->

<!--        .page-header nav a {-->
<!--            margin-left: 15px;-->
<!--            color: #333;-->
<!--            text-decoration: none;-->
<!--            font-weight: 500;-->
<!--        }-->

<!--        .content-wrapper {-->
<!--            width: 1200px;-->
<!--            margin: 30px auto;-->
<!--            background: #fff;-->
<!--            border-radius: 20px;-->
<!--            padding: 30px;-->
<!--            box-shadow: 0 0 10px rgba(0,0,0,0.1);-->
<!--        }-->

<!--        h2 {-->
<!--            margin-bottom: 20px;-->
<!--            font-size: 24px;-->
<!--            color: #333;-->
<!--        }-->

<!--        .review-card {-->
<!--            background: #fafafa;-->
<!--            border-radius: 15px;-->
<!--            padding: 20px;-->
<!--            margin-bottom: 20px;-->
<!--            box-shadow: 0 0 6px rgba(0,0,0,0.05);-->
<!--        }-->

<!--        .review-card h3 {-->
<!--            margin: 0 0 10px;-->
<!--            font-size: 20px;-->
<!--            color: #2c3e50;-->
<!--        }-->

<!--        .review-card p {-->
<!--            margin: 5px 0;-->
<!--            color: #555;-->
<!--        }-->

<!--        .review-card .rating {-->
<!--            color: #f39c12;-->
<!--            font-weight: bold;-->
<!--        }-->

<!--        .no-review {-->
<!--            text-align: center;-->
<!--            color: #999;-->
<!--            padding: 40px 0;-->
<!--        }-->

<!--        .pagination {-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            margin-top: 30px;-->
<!--            gap: 5px;-->
<!--        }-->

<!--        .pagination button {-->
<!--            background: none;-->
<!--            border: 1px solid #ccc;-->
<!--            border-radius: 8px;-->
<!--            padding: 5px 10px;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .pagination button.active {-->
<!--            background: #000;-->
<!--            color: #fff;-->
<!--            font-weight: bold;-->
<!--        }-->

<!--        .pagination button:disabled {-->
<!--            background: #eee;-->
<!--            cursor: default;-->
<!--            color: #aaa;-->
<!--        }-->

<!--        img.review-image {-->
<!--            width: 100%;-->
<!--            max-height: 300px;-->
<!--            object-fit: cover;-->
<!--            border-radius: 10px;-->
<!--            margin-bottom: 10px;-->
<!--        }-->

<!--        @media (max-width: 768px) {-->
<!--            .content-wrapper { width: 90%; padding: 20px; }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<div class="page-header">-->
<!--    <h1>TRAVEL PLANNING</h1>-->
<!--    <nav>-->
<!--        <span>사용자님 환영합니다.</span>-->
<!--        <a href="/">Home</a>-->
<!--        <a href="/mypage">마이페이지</a>-->
<!--        <a href="/logout">로그아웃</a>-->
<!--    </nav>-->
<!--</div>-->

<!--<div class="content-wrapper">-->
<!--    <h2>내가 쓴 리뷰</h2>-->
<!--    <div id="myReviewList"></div>-->
<!--    <div class="pagination" id="pagination"></div>-->
<!--</div>-->

<!--<script>-->
<!--    let currentPage = 0;-->

<!--    async function loadMyReviews(page = 0) {-->
<!--        try {-->
<!--            const res = await fetch(`/reviews/my?page=${page}`, {-->
<!--                method: 'GET',-->
<!--                credentials: 'include'-->
<!--            });-->

<!--            const result = await res.json();-->
<!--            const reviews = result.content;-->
<!--            const container = document.getElementById('myReviewList');-->
<!--            container.innerHTML = "";-->

<!--            if (!reviews || reviews.length === 0) {-->
<!--                container.innerHTML = `<div class="no-review">작성한 리뷰가 없습니다.</div>`;-->
<!--                document.getElementById("pagination").innerHTML = "";-->
<!--                return;-->
<!--            }-->

<!--            reviews.forEach(r => {-->
<!--                const div = document.createElement("div");-->
<!--                div.className = "review-card";-->
<!--                div.style.cursor = "pointer";-->
<!--                div.onclick = () => location.href = `/reviews/view/detail?reviewId=${r.reviewId}`;-->

<!--                let imageTag = '';-->
<!--                if (r.imageUrls && r.imageUrls.length > 0) {-->
<!--                    imageTag = `<img class="review-image" src="${r.imageUrls[0]}" alt="리뷰 이미지">`;-->
<!--                }-->

<!--                div.innerHTML = `-->
<!--                    ${imageTag}-->
<!--                    <h3>${r.title}</h3>-->
<!--                    <p>${r.content}</p>-->
<!--                    <p class="rating">★ ${r.rating} / 5</p>-->
<!--                    <p style="font-size: 14px; color: #888;">작성자: ${r.writer}</p>-->
<!--                `;-->

<!--                container.appendChild(div);-->
<!--            });-->

<!--            renderPagination(result.totalPages, result.number);-->
<!--        } catch (e) {-->
<!--            console.error("리뷰 로딩 실패:", e);-->
<!--            document.getElementById('myReviewList').innerHTML = `<div class="no-review">리뷰를 불러오는 중 오류가 발생했습니다.</div>`;-->
<!--        }-->
<!--    }-->

<!--    function renderPagination(totalPages, current) {-->
<!--        const pagination = document.getElementById("pagination");-->
<!--        pagination.innerHTML = "";-->
<!--        currentPage = current;-->

<!--        if (totalPages <= 1) return;-->

<!--        const prevBtn = document.createElement("button");-->
<!--        prevBtn.textContent = "« 이전";-->
<!--        prevBtn.disabled = currentPage === 0;-->
<!--        prevBtn.onclick = () => loadMyReviews(currentPage - 1);-->
<!--        pagination.appendChild(prevBtn);-->

<!--        for (let i = 0; i < totalPages; i++) {-->
<!--            const pageBtn = document.createElement("button");-->
<!--            pageBtn.textContent = i + 1;-->
<!--            if (i === currentPage) pageBtn.classList.add("active");-->
<!--            pageBtn.onclick = () => loadMyReviews(i);-->
<!--            pagination.appendChild(pageBtn);-->
<!--        }-->

<!--        const nextBtn = document.createElement("button");-->
<!--        nextBtn.textContent = "다음 »";-->
<!--        nextBtn.disabled = currentPage >= totalPages - 1;-->
<!--        nextBtn.onclick = () => loadMyReviews(currentPage + 1);-->
<!--        pagination.appendChild(nextBtn);-->
<!--    }-->

<!--    window.onload = () => loadMyReviews(0);-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내가 쓴 리뷰 (계획별)</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pretendard&display=swap">
    <style>
        /* ======== 1. 공통 레이아웃 (폼과 동일) ======== */
        body {
            font-family: 'Pretendard', sans-serif;
            background: #F4F6FA;
            margin: 0;
            padding: 0;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            padding: 15px 40px;
            border-bottom: 1px solid #E0E0E0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .page-header h1 {
            font-size: 20px;
            margin: 0;
            color: #2C3E50;
            font-weight: 700;
        }
        .page-header nav a {
            margin-left: 15px;
            color: #555;
            text-decoration: none;
            font-weight: 500;
        }
        .content-wrapper {
            max-width: 900px; /* 기존 폼보다 약간 넓게 */
            margin: 40px auto;
            background: #fff;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        h2 {
            margin-bottom: 30px;
            font-size: 26px;
            color: #2C3E50;
            font-weight: 700;
        }
        .no-content {
            text-align: center;
            color: #999;
            padding: 40px 0;
        }
        /* ======== 2. 계획별 카드 스타일 ======== */
        .plan-group {
            background: #F9F9F9;
            border: 1px solid #eee;
            border-radius: 14px;
            margin-bottom: 25px;
            overflow: hidden; /* 내부 카드 radius 적용 */
        }
        .plan-header {
            padding: 20px 25px;
            background: #F1F3F5;
        }
        .plan-header h3 {
            margin: 0;
            font-size: 20px;
            color: #2C3E50;
        }
        .plan-header p {
            margin: 5px 0 0 0;
            color: #555;
            font-size: 15px;
        }
        .review-list-container {
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* ======== 3. 리뷰 카드 스타일 (폼과 유사) ======== */
        .review-card {
            background: #fff;
            border: 1px solid #E0E0E0;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            gap: 20px;
            cursor: pointer;
            transition: box-shadow 0.2s;
        }
        .review-card:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .review-card img.review-image {
            width: 150px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }
        .review-card .review-content {
            flex-grow: 1;
        }
        .review-card h4 {
            margin: 0 0 8px 0;
            font-size: 18px;
            color: #333;
        }
        .review-card p {
            margin: 5px 0;
            color: #555;
            font-size: 15px;
            /* 내용이 길면 2줄만 보이게 */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .review-card .rating {
            color: #F39C12;
            font-weight: 600;
            font-size: 16px;
        }
    </style>
</head>
<body>
<div class="page-header">
    <h1>TRAVEL PLANNING</h1>
    <nav>
        <span>사용자님 환영합니다.</span>
        <a href="/">Home</a>
        <a href="/mypage">마이페이지</a>
        <a href="/logout">로그아웃</a>
    </nav>
</div>
<div class="content-wrapper">
    <h2>내가 쓴 리뷰 (계획별)</h2>
    <div id="planReviewList">
        <p class="no-content">작성한 여행 계획을 불러오는 중입니다...</p>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        loadPlansAndReviews();
    });
    // 1. 모든 여행 계획을 불러옵니다.
    async function loadPlansAndReviews() {
        const listContainer = document.getElementById("planReviewList");
        try {
            // 1-1. 'GET /plans' API 호출 (PlanController)
            const planResponse = await fetch('/plans', {
                method: 'GET',
                credentials: 'include'
            });
            if (!planResponse.ok) throw new Error("여행 계획 로딩 실패");
            const planResDto = await planResponse.json();
            const plans = planResDto.data; // List<PlanDetailResDto>
            if (!plans || plans.length === 0) {
                listContainer.innerHTML = `<div class="no-content">작성한 여행 계획이 없습니다.</div>`;
                return;
            }
            listContainer.innerHTML = ""; // 로딩 메시지 제거
            // 1-2. 각 계획별로 리뷰를 순차적으로 불러옵니다.
            for (const plan of plans) {
                const planGroup = document.createElement("div");
                planGroup.className = "plan-group";
                const planHeader = document.createElement("div");
                planHeader.className = "plan-header";
                planHeader.innerHTML = `
                    <h3>${plan.title}</h3>
                    <p>${plan.startDate} ~ ${plan.endDate}</p>
                `;
                // 리뷰가 들어갈 컨테이너 생성
                const reviewContainer = document.createElement("div");
                reviewContainer.className = "review-list-container";
                reviewContainer.id = `reviews-for-plan-${plan.id}`;
                reviewContainer.innerHTML = `<p style="color: #888;">리뷰를 불러오는 중...</p>`;
                planGroup.appendChild(planHeader);
                planGroup.appendChild(reviewContainer);
                listContainer.appendChild(planGroup);
                // 1-3. 해당 planId로 리뷰를 불러오는 함수 호출
                loadReviewsForPlan(plan.id, reviewContainer.id);
            }
        } catch (e) {
            console.error("로딩 실패:", e);
            listContainer.innerHTML = `<div class="no-content">리뷰를 불러오는 중 오류가 발생했습니다.</div>`;
        }
    }
    // 2. 특정 planId에 대한 리뷰를 불러옵니다.
    async function loadReviewsForPlan(planId, containerId) {
        const container = document.getElementById(containerId);
        try {
            // 2-1. 'GET /reviews/course' API로 planId -> courseId(targetId)를 가져옵니다.
            const targetResponse = await fetch(`/reviews/course?planId=${planId}`, {
                method: 'GET',
                credentials: 'include'
            });
            if (!targetResponse.ok) {
                // 이 계획에 연결된 코스가 없는 경우
                container.innerHTML = `<p style="color: #888;">이 계획에는 코스가 없거나 리뷰 대상이 아닙니다.</p>`;
                return;
            }
            const targetDto = await targetResponse.json(); // ReviewTargetDto
            const courseId = targetDto.targetId;
            const courseType = targetDto.type; // "course"
            // 2-2. 'GET /reviews/target' API로 courseId로 작성된 리뷰를 가져옵니다.
            const reviewResponse = await fetch(`/reviews/target?type=${courseType}&id=${courseId}`, {
                method: 'GET',
                credentials: 'include'
            });
            if (!reviewResponse.ok) throw new Error("리뷰 로딩 실패");
            const reviewPage = await reviewResponse.json(); // Page<ReviewDetailDto>
            const reviews = reviewPage.content;
            if (!reviews || reviews.length === 0) {
                container.innerHTML = `<p style="color: #888;">이 코스에 대해 작성한 리뷰가 없습니다.</p>`;
                return;
            }
            container.innerHTML = ""; // 로딩 메시지 제거
            // 2-3. 가져온 리뷰들(List<ReviewDetailDto>)을 화면에 그립니다.
            reviews.forEach(r => {
                const div = document.createElement("div");
                div.className = "review-card";
                // 상세 페이지로 이동 (course-review-detail.html)
                // (이전 파일의 URL을 그대로 사용합니다)
                div.onclick = () => location.href = `/reviews/view/detail?reviewId=${r.reviewId}`;
                let imageTag = '';
                if (r.imageUrls && r.imageUrls.length > 0) {
                    imageTag = `<img class="review-image" src="${r.imageUrls[0]}" alt="리뷰 이미지">`;
                } else {
                    // 이미지가 없으면 기본 이미지
                    imageTag = `<img class="review-image" src="/images/default-thumbnail.png" alt="리뷰 이미지">`;
                }
                div.innerHTML = `
                    ${imageTag}
                    <div class="review-content">
                        <h4>${r.title}</h4>
                        <p class="rating">★ ${r.rating}</p>
                        <p>${r.content}</p>
                    </div>
                `;
                container.appendChild(div);
            });
        } catch (e) {
            console.error(`Plan ${planId}의 리뷰 로딩 실패:`, e);
            container.innerHTML = `<p style="color: #E74C3C;">리뷰를 불러오는 중 오류가 발생했습니다.</p>`;
        }
    }
</script>
</body>
</html>
