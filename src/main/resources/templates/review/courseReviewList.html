<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>코스 리뷰 목록 | Travel Planning</title>
    <link th:href="@{/css/review.css}" rel="stylesheet">
</head>
<body>
<header>
    <div class="logo">
        <img th:src="@{/images/logo.png}" alt="Logo">
        <span class="title">TRAVEL PLANING</span>
    </div>
    <nav>
        <a th:href="@{/}">홈</a>
        <a th:href="@{/mypage}">마이페이지</a>
        <a th:href="@{/logout}">로그아웃</a>
    </nav>
</header>

<main>
    <div class="container">
        <h2>코스 리뷰 목록</h2>
        <div id="reviewList">
            <!-- JS로 채워짐 -->
        </div>
    </div>
</main>

<footer>
    &copy; 2025 Travel Planning. All rights reserved.
</footer>

<script th:src="@{/js/common.js}"></script>
<script>
    const courseId = [[${courseId}]];

    async function loadCourseReviews() {
        try {
            const response = await fetchWithRefresh(`/reviews/courses/${courseId}`, {
                method: "GET",
                headers: { "Content-Type": "application/json" },
                credentials: "include"
            });

            if (!response.ok) {
                alert("리뷰를 불러오지 못했습니다.");
                return;
            }

            const result = await response.json();
            const reviewListDiv = document.getElementById("reviewList");
            reviewListDiv.innerHTML = "";

            if (result.data.length === 0) {
                reviewListDiv.innerHTML = "<p>등록된 리뷰가 없습니다.</p>";
                return;
            }

            result.data.forEach(review => {
                const reviewDiv = document.createElement("div");
                reviewDiv.classList.add("review-card");
                reviewDiv.innerHTML = `
                    <h3>${review.title}</h3>
                    <p><strong>작성자:</strong> ${review.writer}</p>
                    <p>${review.content}</p>
                    ${review.images?.map(img => `<img src="${img}" alt="리뷰 이미지" width="150"/>`).join('') ?? ''}
                    <hr>
                `;
                reviewListDiv.appendChild(reviewDiv);
            });

        } catch (error) {
            console.error("리뷰 로딩 중 오류:", error);
        }
    }

    window.onload = loadCourseReviews;
</script>
</body>
</html>
