<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내가 쓴 리뷰</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<header>
    <div class="header-container">
        <div class="logo">TRAVEL PLANING</div>
        <nav>
            <a href="/">Home</a>
            <a href="/mypage">마이페이지</a>
            <a href="/logout">로그아웃</a>
        </nav>
    </div>
</header>

<main>
    <div class="content-wrapper" style="width: 80%; margin: 40px auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
        <h2 style="font-size: 24px; color: #333; margin-bottom: 20px;">내가 쓴 리뷰</h2>
        <div id="myReviewList"></div>
        <div class="pagination" id="pagination" style="margin-top: 30px; text-align: center;"></div>
    </div>
</main>

<script th:src="@{/js/common.js}"></script>
<script>
    let currentPage = 0;

    async function loadMyReviews(page = 0) {
        try {
            const res = await fetchWithRefresh(`/reviews/my?page=${page}`, {
                method: 'GET',
                credentials: 'include'
            });
            const result = await res.json();
            const reviews = result.content;
            const container = document.getElementById('myReviewList');
            container.innerHTML = "";

            if (!reviews || reviews.length === 0) {
                container.innerHTML = `<p style="text-align:center; color:#999;">작성한 리뷰가 없습니다.</p>`;
                document.getElementById("pagination").innerHTML = "";
                return;
            }

            reviews.forEach(r => {
                const div = document.createElement("div");
                div.style = "background:#fafafa; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 0 6px rgba(0,0,0,0.05);";
                div.innerHTML = `
                    <h3 style="margin:0 0 10px; color:#2c3e50;">${r.title}</h3>
                    <p>${r.content}</p>
                    <p style="color:#f39c12; font-weight:bold;">★ ${r.rating} / 5</p>
                    <p style="font-size: 14px; color: #888;">작성자: ${r.writer}</p>
                `;
                container.appendChild(div);
            });

            renderPagination(result.totalPages, result.number);
        } catch (e) {
            console.error("리뷰 로딩 실패:", e);
            document.getElementById('myReviewList').innerHTML = `<p style="text-align:center; color:#f00;">리뷰를 불러오는 중 오류가 발생했습니다.</p>`;
        }
    }

    function renderPagination(totalPages, current) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";
        currentPage = current;

        if (totalPages <= 1) return;

        const prevBtn = document.createElement("button");
        prevBtn.textContent = "« 이전";
        prevBtn.disabled = currentPage === 0;
        prevBtn.onclick = () => loadMyReviews(currentPage - 1);
        pagination.appendChild(prevBtn);

        for (let i = 0; i < totalPages; i++) {
            const pageBtn = document.createElement("button");
            pageBtn.textContent = i + 1;
            pageBtn.style = `margin: 0 3px; padding: 5px 10px; border-radius: 6px; border: 1px solid #ccc; background: ${i === currentPage ? '#007bff' : 'white'}; color: ${i === currentPage ? 'white' : '#000'}; cursor: pointer;`;
            pageBtn.onclick = () => loadMyReviews(i);
            pagination.appendChild(pageBtn);
        }

        const nextBtn = document.createElement("button");
        nextBtn.textContent = "다음 »";
        nextBtn.disabled = currentPage >= totalPages - 1;
        nextBtn.onclick = () => loadMyReviews(currentPage + 1);
        pagination.appendChild(nextBtn);
    }

    window.onload = () => loadMyReviews(0);
</script>
</body>
</h