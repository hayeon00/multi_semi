<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íšŒì›ê°€ì… | Travel Planing</title>
    <link th:href="@{/css/signup.css}" rel="stylesheet">
</head>
<body>
<div class="container">
    <!-- í—¤ë” -->
    <header class="signup-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-box">
                    <img th:src="@{/images/logo.png}" alt="Logo">
                </div>
                <span class="site-title">TRAVEL PLANING</span>
            </div>
            <nav class="header-nav">
                <a th:href="@{/spots/view/tourspotlist}" class="nav-link">Home</a>
            </nav>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="signup-main">
        <div class="signup-layout">
            <!-- ì™¼ìª½: ì œëª© ë° ì„¤ëª… -->
            <div class="signup-title-section">
                <h1 class="signup-title">íšŒì›ê°€ì… í¼</h1>
                <p class="signup-desc">ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ <br>ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”</p>
            </div>

            <!-- ì˜¤ë¥¸ìª½: í¼ -->
            <div class="signup-form-section">
                <form id="signupForm" onsubmit="event.preventDefault(); signup();">
                    <div class="form-field">
                        <label for="loginId" class="field-label">ì•„ì´ë””</label>
                        <input type="text"
                               id="loginId"
                               class="field-input"
                               placeholder="Enter your ID"
                               autocomplete="username"
                               required>
                    </div>

                    <div class="form-field">
                        <label for="password" class="field-label">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password"
                               id="password"
                               class="field-input"
                               placeholder="Create a password"
                               autocomplete="new-password"
                               required>
                    </div>

                    <div class="form-field">
                        <label for="username" class="field-label">ì´ë¦„</label>
                        <input type="text"
                               id="username"
                               class="field-input"
                               placeholder="Enter your name"
                               autocomplete="name"
                               required>
                    </div>

                    <div class="form-field">
                        <label for="tel" class="field-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="tel"
                               id="tel"
                               class="field-input"
                               placeholder="Enter your phone number"
                               autocomplete="tel"
                               required>
                    </div>

                    <div class="form-field">
                        <label for="email" class="field-label">ì´ë©”ì¼</label>
                        <input type="email"
                               id="email"
                               class="field-input"
                               placeholder="Enter your email"
                               autocomplete="email"
                               required>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-cancel" onclick="location.href='/login'">
                            ì·¨ì†Œ
                        </button>
                        <button type="submit" class="btn btn-signup">
                            ê³„ì • ìƒì„±
                        </button>
                    </div>
                </form>

                <div class="message" id="msg"></div>

                <div class="login-link">
                    ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/login">ë¡œê·¸ì¸</a>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- í‘¸í„° -->
<footer class="signup-footer">
    <p>&copy; 2025 Travel Planing. All rights reserved.</p>
</footer>

<script>
    async function signup() {
        const loginId = document.getElementById("loginId").value.trim();
        const password = document.getElementById("password").value.trim();
        const username = document.getElementById("username").value.trim();
        const tel = document.getElementById("tel").value.trim();
        const email = document.getElementById("email").value.trim();

        // ì…ë ¥ ê²€ì¦
        if (!loginId || !password || !username || !tel || !email) {
            showMessage("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
            return;
        }

        // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailPattern.test(email)) {
            showMessage("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
            return;
        }

        // ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì¦ (ì„ íƒì‚¬í•­)
        const telPattern = /^[0-9-]+$/;
        if (!telPattern.test(tel)) {
            showMessage("ì „í™”ë²ˆí˜¸ëŠ” ìˆ«ìì™€ í•˜ì´í”ˆ(-)ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.", "error");
            return;
        }

        try {
            const response = await fetch("/auth/signup", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    loginId: loginId,
                    password: password,
                    username: username,
                    tel: tel,
                    email: email
                })
            });

            console.log("ì‘ë‹µ ìƒíƒœì½”ë“œ:", response.status);
            const text = await response.text();
            console.log("ì‘ë‹µ ë°”ë””:", text);

            if (response.ok) {
                showMessage("íšŒì›ê°€ì… ì„±ê³µ! ğŸ‰ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.", "success");
                setTimeout(() => window.location.href = "/login", 1500);
            } else {
                showMessage("íšŒì›ê°€ì… ì‹¤íŒ¨. ì…ë ¥ê°’ì„ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”.", "error");
            }
        } catch (e) {
            console.error("íšŒì›ê°€ì… ì˜¤ë¥˜:", e);
            showMessage("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
    }

    function showMessage(text, type) {
        const msgBox = document.getElementById("msg");
        msgBox.textContent = text;
        msgBox.className = "message " + type;
        msgBox.style.display = "block";
    }

    // ì‹¤ì‹œê°„ ì…ë ¥ ê²€ì¦ (ì„ íƒì‚¬í•­)
    document.getElementById("email").addEventListener("blur", function() {
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (this.value && !emailPattern.test(this.value)) {
            this.style.borderColor = "#e74c3c";
        } else {
            this.style.borderColor = "";
        }
    });

    document.getElementById("tel").addEventListener("blur", function() {
        const telPattern = /^[0-9-]+$/;
        if (this.value && !telPattern.test(this.value)) {
            this.style.borderColor = "#e74c3c";
        } else {
            this.style.borderColor = "";
        }
    });
</script>
</body>
</html>