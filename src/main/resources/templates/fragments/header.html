<header th:fragment="commonHeader"
        class="header"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <div class="header-container">

        <!-- ========= ì¢Œì¸¡ : ë¡œê·¸ì¸ ìœ ì € ì •ë³´ ========= -->
        <div class="left-area">

            <!-- ë¡œê·¸ì¸ O -->
            <div class="user-info" sec:authorize="isAuthenticated()">
                <i class="fas fa-user-circle user-icon"></i>
                <span class="username" sec:authentication="principal.userId"></span>
                <span class="welcome">ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</span>
            </div>

            <!-- ë¡œê·¸ì¸ X -->
            <div class="user-info" sec:authorize="isAnonymous()">
                <i class="fas fa-user user-icon"></i>
                <span class="welcome">ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</span>
            </div>

        </div>


        <!-- ========= ì¤‘ì•™ : ë¡œê³  ========= -->
        <div class="center-area">
            <a th:href="@{/}">
                <img th:src="@{/images/logo.png}" alt="Logo" class="logo">
            </a>
            <span class="title">TRAVEL PLANNING</span>
        </div>


        <!-- ========= ìš°ì¸¡ : ë©”ë‰´ ========= -->
        <div class="right-area">

            <!-- PUBLIC & USER ë©”ë‰´ -->
            <nav class="common-nav">

                <a th:href="@{/}" class="nav-link">
                    <span class="icon">ğŸ </span> Home
                </a>

                <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ (API í˜¸ì¶œ ë°©ì‹ìœ¼ë¡œ ë³€ê²½) -->
                <button type="button" class="logout-btn nav-link" onclick="handleLogout()" sec:authorize="isAuthenticated()">
                    <span class="icon">ğŸšª</span> ë¡œê·¸ì•„ì›ƒ
                </button>
            </nav>

            <nav class="login-nav">
                <a th:href="@{/login}" class="nav-link" sec:authorize="isAnonymous()">
                    <span class="icon">ğŸ”</span> ë¡œê·¸ì¸
                </a>

                <a th:href="@{/member/view/join}" class="nav-link" sec:authorize="isAnonymous()">
                    <span class="icon">âœï¸</span> íšŒì›ê°€ì…
                </a>
                <a th:href="@{/member/view/mypage}" class="nav-link" sec:authorize="hasRole('USER')">
                    <span class="icon">ğŸ™â€â™‚ï¸</span> ë§ˆì´í˜ì´ì§€
                </a>

            </nav>

            <!-- ADMIN ë©”ë‰´ -->
            <nav class="admin-nav" sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/admin/view/adminpage}" class="nav-link">
                    <span class="icon">ğŸ› ï¸</span> ê´€ë¦¬ì í˜ì´ì§€
                </a>
                <a th:href="@{/admin/view/dashboard}" class="nav-link">
                    <span class="icon">ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
                </a>
            </nav>
        </div>
    </div>

    <!-- ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
    <script th:inline="javascript">
        async function handleLogout() {
            try {
                const response = await fetchWithRefresh('/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include' // ì¿ í‚¤ í¬í•¨
                });

                if (response.ok) {
                    alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    window.location.href = '/login';
                } else {
                    const result = await response.json();
                    alert(result.message || 'ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</header>