<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인 | Travel Planing</title>

    <!-- ✅ 외부 CSS 연결 -->
    <link th:href="@{/css/login.css}" rel="stylesheet">
</head>
<body>
<header>
    <div class="logo">
        <img th:src="@{/images/logo.png}" alt="Logo">
        <span class="title">TRAVEL PLANING</span>
    </div>
    <nav>
        <a th:href="@{/}">Home</a>
    </nav>
</header>

<main>
    <div class="left-section">
        <h2>로그인 폼</h2>
    </div>

    <div class="right-section">
        <div class="form-group">
            <label for="loginId">아이디</label>
            <input type="text" id="loginId" placeholder="Enter your username">
            <div class="hint">당신을 구분하는 고유한 아이디입니다.</div>
        </div>

        <div class="form-group">
            <label for="password">비밀번호</label>
            <input type="password" id="password" placeholder="Enter your password">
            <div class="hint">보안에 유의하세요</div>
        </div>

        <div class="btn-group">
            <button type="button" class="btn signup" onclick="location.href='/signup'">회원 가입</button>
            <button type="button" class="btn login" onclick="login()">로그인</button>
        </div>

        <div class="msg" id="msg"></div>
    </div>
</main>

<footer>
    &copy; 2025 Travel Planing. All rights reserved.
</footer>

<script>
    async function login() {
        const loginId = document.getElementById("loginId").value.trim();
        const password = document.getElementById("password").value.trim();
        const msgBox = document.getElementById("msg");

        if (!loginId || !password) {
            msgBox.textContent = "아이디와 비밀번호를 입력해주세요.";
            msgBox.style.color = "red";
            return;
        }

        try {
            const response = await fetch("/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                credentials: "include", // ✅ 쿠키 포함 (JWT 쿠키 전달용)
                body: JSON.stringify({ loginId, password })
            });

            const result = await response.json();
            console.log("응답 상태코드:", response.status);
            console.log("응답 바디:", result);

            if (response.ok && result.status === 200) {
                msgBox.textContent = result.message || "로그인 성공!";
                msgBox.style.color = "green";
                // ✅ 로그인 성공 → 메인페이지로 이동
                setTimeout(() => window.location.href = "/spots/view/tourspotlist", 500);
            } else {
                msgBox.textContent = result.message || "로그인 실패. 아이디/비밀번호를 확인해주세요.";
                msgBox.style.color = "red";
            }
        } catch (e) {
            console.error("로그인 에러:", e);
            msgBox.textContent = "서버 오류가 발생했습니다.";
            msgBox.style.color = "red";
        }
    }
</script>
</body>
</html>
