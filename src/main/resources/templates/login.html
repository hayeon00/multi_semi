<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인 | Travel Planing</title>
    <link th:href="@{/css/login.css}" rel="stylesheet">
</head>
<body>
<div class="container">
    <!-- 헤더 -->
    <header class="login-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-box">
                    <img th:src="@{/images/logo.png}" alt="Logo">
                </div>
                <span class="site-title">TRAVEL PLANING</span>
            </div>
            <nav class="header-nav">
                <a th:href="@{/}" class="nav-link">Home</a>
            </nav>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="login-main">
        <div class="login-layout">
            <!-- 왼쪽: 제목 -->
            <div class="login-title-section">
                <h1 class="login-title">로그인 폼</h1>
            </div>

            <!-- 오른쪽: 폼 -->
            <div class="login-form-section">
                <form id="loginForm" onsubmit="event.preventDefault(); login();">
                    <div class="form-field">
                        <label for="loginId" class="field-label">아이디</label>
                        <input type="text"
                               id="loginId"
                               class="field-input"
                               placeholder="Enter your username"
                               autocomplete="username">
                        <div class="field-hint">당신을 구분하는 고유한 아이디입니다.</div>
                    </div>

                    <div class="form-field">
                        <label for="password" class="field-label">비밀번호</label>
                        <input type="password"
                               id="password"
                               class="field-input"
                               placeholder="Enter your password"
                               autocomplete="current-password">
                        <div class="field-hint">보안에 유의하세요</div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-signup" onclick="location.href='/signup'">
                            회원 가입
                        </button>
                        <button type="submit" class="btn btn-login">
                            로그인
                        </button>
                    </div>
                </form>

                <div class="message" id="msg"></div>
            </div>
        </div>
    </main>
</div>

<!-- 푸터 -->
<footer class="login-footer">
    <p>&copy; 2025 Travel Planing. All rights reserved.</p>
</footer>

<script>
    async function login() {
        const loginId = document.getElementById("loginId").value.trim();
        const password = document.getElementById("password").value.trim();
        const msgBox = document.getElementById("msg");

        // 입력 검증
        if (!loginId || !password) {
            showMessage("아이디와 비밀번호를 입력해주세요.", "error");
            return;
        }

        try {
            const response = await fetch("/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                credentials: "include",
                body: JSON.stringify({ loginId, password })
            });

            const result = await response.json();
            console.log("응답 상태코드:", response.status);
            console.log("응답 바디:", result);

            if (response.ok && result.status === 200) {
                showMessage(result.message || "로그인 성공!", "success");
                setTimeout(() => window.location.href = "/spots/view/tourspotlist", 500);
            } else {
                showMessage(result.message || "로그인 실패. 아이디/비밀번호를 확인해주세요.", "error");
            }
        } catch (e) {
            console.error("로그인 에러:", e);
            showMessage("서버 오류가 발생했습니다.", "error");
        }
    }

    function showMessage(text, type) {
        const msgBox = document.getElementById("msg");
        msgBox.textContent = text;
        msgBox.className = "message " + type;
        msgBox.style.display = "block";
    }

    // 엔터키로 로그인
    document.getElementById("password").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            login();
        }
    });
</script>
</body>
</html>